{% extends "header.html" %}

{% block content %}

{% load static %}
{% load i18n %}
<div id="chat-interface-container">
    <div id="chat-interface-messages">
        <div class="messageAndElement-chat-zone">
            <div class="message-chat-zone">{{premiermessage}}</div>
            <img src="{% static 'assets/bot.png' %}" alt="" class="bot-avatar">
        </div>
    </div>
    <div id="user-chat-input">
        <input type="text" id="chat-message-input" placeholder="Type your message...">
        <button id="chat-send-button"><i class="fas fa-paper-plane"></i></button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const messageInput = document.getElementById("chat-message-input");
        const sendButton = document.getElementById("chat-send-button");
        const chatMessages = document.getElementById("chat-interface-messages");

        sendButton.addEventListener("click", function() {
            const message = messageInput.value;
            if (message.trim() !== "") {
                appendMessage("user", message);
                sendMessageToServer(message);
                messageInput.value = "";
            }
        });

        function appendMessage(sender, message) {
            const messageAndElement = document.createElement("div");
            const messageElement = document.createElement("div");
            const profileImage = document.createElement("img");

            if (sender === 'user') {
                messageAndElement.className = "messageAndElement-user-zone";
                messageElement.className = "message-user-zone";
                profileImage.src = "{% static 'assets/user.png' %}";
                profileImage.className = "user-avatar";
                messageAndElement.appendChild(profileImage);
                messageAndElement.appendChild(messageElement);
            } else {
                messageAndElement.className = "messageAndElement-chat-zone";
                messageElement.className = "message-chat-zone";
                profileImage.src = "{% static 'assets/bot.png' %}";
                profileImage.className = "bot-avatar";
                messageAndElement.appendChild(messageElement);
                messageAndElement.appendChild(profileImage);
            }

            messageElement.classList.add("message", sender);
            messageElement.textContent = message;
            chatMessages.appendChild(messageAndElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function sendMessageToServer(message) {
            axios.post('', { message: message })
            .then(response => {
                appendMessage("bot", response.data.response);
            })
            .catch(error => {
                appendMessage("bot", "GPT is currently unavailable ðŸ¤–");
                console.error('Error:', error);
            });
        }
    });
</script>

{% endblock content %}
